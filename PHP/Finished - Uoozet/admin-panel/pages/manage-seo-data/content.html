<?php
error_reporting(E_ALL);
global $site_url;
if (!empty($_GET['id'])) {
/*switch($seoData['page']) {
    case "watch":
        $vm = new Video();
        $vm->$vm->setBinary_conditions(array('id'=>$seoData['content_id']));
        $get_video = $vm->getMatches(Video::RETURN_ARRAY)[0];
$url = 'watch/' . PT_Slug($get_video['title'], $get_video['video_id']);
break;
    case "articles/read":
        $am = new Article();
        $post = $am->getOne(['id'=>$seoData['content_id']])[0];
        $url = $metaDesc['page'] . "/" . PT_URLSlug($post->title,$post->id);
        break;
    default:
        if(strpos($seoData['page'], '@') !== FALSE) {
            $url = $seoData['page'] . "?vid=" . $seoData['content_id'];
        } else $url = $seoData['page'];
        break;
    }
}*/
$id = intval($_GET['id']);
$sd = new SeoData();
$seoData = $sd->getOneById($id);

?>

<style>
    iframe body {
        overflow: hidden;
    }
</style>
<div class="container-fluid">
    <div class="block-header">
        <h2>SEO Data > Edit Seo Data</h2>
    </div>
    <!-- Vertical Layout -->
    <div class="row">
        <div class="col-lg-6 col-md-6">
            <div class="card">
                <div class="header">
                    <h2>Edit Seo Data</h2>
                </div>
                <div class="body">
                    <form method="POST" id="add_meta_desc_form" onsubmit="return false;">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group form-float">
                                    <div class="form-line">
                                        <input type="text" class="form-control" name="url" value="<?= $seoData['url']; ?>" disabled>
                                        <label class="form-label">URL</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group form-float">
                                    <div class="form-line">
                                        <input type="text" class="form-control" name="page" value="<?= $seoData['page']; ?>" disabled>
                                        <label class="form-label">Page</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group form-float">
                                    <div class="form-line">
                                        <input type="text" class="form-control" name="cid" value="<?= $seoData['content_id']; ?>" disabled>
                                        <label class="form-label">CID</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="form-group form-float">
                                    <div class="form-line" style="float:left; width: auto; max-width: 100%; min-width: 100%;">
                                        <textarea type="text" class="form-control" name="desc" style="min-height: 50px; max-width: 100%; min-width: 100%;"><?= $seoData['desc']; ?></textarea>
                                        <label class="form-label">Description</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="form-group form-float">
                                    <div class="form-line" style="float:left; width: auto; max-width: 100%; min-width: 100%;">
                                        <textarea type="text" class="form-control" name="canonical" style="min-height: 50px; max-width: 100%; min-width: 100%;"><?=
                                                (
                                                !is_null($seoData['canonical']) ?
                                                implode(',', json_decode($seoData['canonical'])) : ""
                                                );
                                            ?></textarea>
                                        <label class="form-label">Canonicals (seperate with comma ',')</label>
                                    </div>
                                </div>
                            </div>
                            <div class="clearfix"></div>
                            <div class="col-md-2">
                                <button class="btn btn-info" onclick="edit_meta_desc()">Edit</button>
                            </div>
                            <div class="col-md-2">
                                <button class="btn btn-info" onclick="window.location.href='<?= PT_LoadAdminLinkSettings("manage-seo-data"); ?>'">Back</button>
                            </div>
                        </div>
                        <div class="clearfix"></div>
                    </form>
                    <!-- ==================================================================================== -->
                </div>
            </div>
        </div>
        <div class="col-lg-6 col-md-6">
            <iframe src="<?= $seoData['url']; ?>" style="width: 100%;height: 500px;"></iframe>
        </div>
        <div class="clearfix"></div>
    </div>
</div>
<?php } else { ?>
<div class="container-fluid">
    <div class="block-header">
        <h2>Meta > Meta Description</h2>
    </div>
    <!-- Vertical Layout -->
    <div class="row">
        <div class="col-lg-6 col-md-6">
            <div class="card">
                <div class="header">
                    <h2>Manage & Add Meta Descriptions</h2>
                </div>
                <div class="body">
                    <form method="POST" id="add_meta_desc_form" onsubmit="return false;">
                        <div class="row">
                            <div class="col-md-10">
                                <div class="form-group form-float">
                                    <div class="form-line">
                                        <input type="text" class="form-control" name="url">
                                        <label class="form-label">URL</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <button class="btn btn-info" onclick="add_meta_desc()">Add</button>
                            </div>
                        </div>
                        <div class="clearfix"></div>
                    </form>
                    <!-- ==================================================================================== -->
                    <div class="table-responsive">
                        <table class="table table-bordered table-striped table-hover">
                            <thead>
                            <tr>
                                <th style="text-align: center;">Page</th>
                                <th style="text-align: center;">CID</th>
                                <th style="text-align: center;">Description</th>
                                <th style="text-align: center;">Action</th>
                            </tr>
                            </thead>
                            <tbody>
                            <?php
                                $sd = new SeoData();
                                $sList = $sd->getAll();
                                echo $sd->generateAdminViewList($sList);
                            ?>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="clearfix"></div>
    </div>
<?php } ?>
    <!-- #END# Vertical Layout -->
<script>
    function delete_metaDesc(id,self) {
        if (id == '') {
            return false;
        }
        if (!confirm('Are you sure you want to delete this SEO Info?')) {
            return false;
        }
        $('#' + id).fadeOut(300, function () {
            $(this).remove();
        });
        $.get('{{LINK aj/ap/delete_seoData}}', {id:id});
    }
    function add_meta_desc() {
        let form = $("#add_meta_desc_form");
        let url = $(form).find("input[name='url']").val().trim();
        $.get('{{LINK aj/ap/add_seoData}}', {url: url}, function (){
            // location.reload();
        });
    }
    function edit_meta_desc() {
        let form = $("#add_meta_desc_form");
        let url = $(form).find("input[name='url']").val().trim();
        let page = $(form).find("input[name='page']").val().trim();
        let cid = $(form).find("input[name='cid']").val().trim();
        if (cid.length === 0) cid = -1;
        else cid = parseInt(cid);
        let desc = $(form).find("textarea[name='desc']").val().trim();
        let canonical = $(form).find("textarea[name='canonical']").val().trim();
        // alert(page + cid + desc);
        $.get('{{LINK aj/ap/edit_seoData}}', {url: url, page: page, cid: cid, desc: desc, canonical: canonical}, function () {
            window.location.href = "<?php echo PT_LoadAdminLinkSettings('manage-seo-data');?>";
        });
    }
</script>