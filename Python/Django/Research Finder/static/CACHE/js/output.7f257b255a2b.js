class BaseArchiveCrawler{constructor(csrf_token,type,perPage,resultPages,applyFilter,isMounted,sortBy,filterTypes){this.type=type;this.perPage=perPage;this.resultPages=resultPages;this.isMounted=isMounted;this.sortBy=sortBy;this.filterTypes=filterTypes;this.csrf_token=csrf_token;}
beforeSubmit(event){event.preventDefault();this.applyFilter($("#filterType").val().trim(),$("#search-form input[name='filter']").val().trim(),this.type);}
filterIt(){this.$emit('searching');let that=this;let k=_.debounce(function(){let input=$("#search-input").val();let table=$(".results-table")[0];let rows=$(table).find("tbody > tr:not(#zero-result):not(#table-loader):not(.filtered)");$(rows).removeClass('included');let sortCol=$(".results-table th.sort-by")[0];let sortByIndex=$(".results-table th").index(sortCol);if(!$(sortCol).hasClass('sort-applied')){let reverse=$(sortCol).hasClass('sort-reversed');let is_total_books=(($($(rows[0]).find("td:not(.tw-hidden)")[sortByIndex]).data('cat')=='books')||($($(rows[0]).find("td:not(.tw-hidden)")[sortByIndex]).data('cat')=='id'));rows=rows.sort(function(a,b){let txta=$(a).find("td:not(.tw-hidden)")[sortByIndex].innerText;let txtb=$(b).find("td:not(.tw-hidden)")[sortByIndex].innerText;let r;if(sortByIndex!==0)
r=txta.localeCompare(txtb);else{txta=parseInt(txta);txtb=parseInt(txtb);if(txta>txtb)r=-1;else if(txta<txtb)r=1;else r=0;}
if(is_total_books){r*=-1;}
if(reverse){r*=-1;}
return r;});$(sortCol).addClass('sort-applied');}
let valid_rows=[],total_rows=[];for(let i=0;i<rows.length;i++){if(that.apply(rows[i],input)!=-1){valid_rows.push(rows[i]);$(rows[i]).addClass('included');}
total_rows.push(rows[i]);}
let pages=[];let j=-1;let k=0;do{pages.push([]);j++;for(let i=0;i<Math.min(that.perPage,valid_rows.length);i++){pages[j].push(valid_rows[i+j*that.perPage]);k++;}}while(valid_rows.length>k);that.$emit('searched',{total:total_rows,valid:pages});},500);k();}
apply(subject,input,type=undefined){if(input.trim().length===0)return 1;if(type==undefined){type=$("#filterType").val();}
type=type.trim();switch(type){case'f':return subject.textContent.search(new RegExp(input,'i'));case'id':let id=$(subject).find('[data-cat=id]')[0];return id.textContent==input?1:-1;case'l':let langs=$(subject).find('[data-cat=langs]')[0].textContent;if($(subject).find('[data-cat=olang]').length>0)
langs+=$(subject).find('[data-cat=olang]')[0].textContent;return langs.search(new RegExp(input,'i'));case'ud':let updateD=$(subject).find('[data-cat=updated_at]')[0];return updateD.textContent.search(new RegExp(input,'i'));case'cd':let createD=$(subject).find('[data-cat=created_at]')[0];return createD.textContent.search(new RegExp(input,'i'));case't':let title=$(subject).find('[data-cat=name]')[0];return title.textContent.search(new RegExp(input,'i'));case'i':let isbn=$(subject).find('[data-cat=isbn]')[0];return isbn.textContent.search(new RegExp(input,'i'));case'g':let genre=$(subject).find('[data-cat=genre]')[0];return genre.textContent.search(new RegExp(input,'i'));case'au':let author=$(subject).find('[data-cat=author]')[0];return author.textContent.search(new RegExp(input,'i'));case'ai':let author_id=$(subject).find('[data-cat=author_id]')[0];return author_id.textContent==input?1:-1;case'rd':let releaseD=$(subject).find('[data-cat=release_date]')[0];return releaseD.textContent.search(new RegExp(input,'i'));case'n':let name=$(subject).find('[data-cat=name]')[0];return name.textContent.search(new RegExp(input,'i'));case'o':let origin=$(subject).find('[data-cat=origin]')[0];return origin.textContent.search(new RegExp(input,'i'));case'b':let birth=$(subject).find('[data-cat=birth]')[0];return birth.textContent.search(new RegExp(input,'i'));case'd':let death=$(subject).find('[data-cat=death]')[0];return death.textContent.search(new RegExp(input,'i'));}}
mounted(){this.filterIt();this.isMounted=true;let headings=$('.results-table thead th:not(:last-child)');let that=this;$(headings).click(function(e){$('th.sort-applied').removeClass('sort-applied');if(!$(e.target).hasClass('sort-by')){$("th.sort-by").removeClass('sort-by');$(e.target).addClass('sort-by');}else{$(e.target).toggleClass('sort-reversed');}
that.filterIt();});}
toggleSearchField(filterElem){$(filterElem).find("span:not(.dropdown-item-text)").toggleClass("active");}
toggleSortField(sortElem){let icon=$(sortElem).find("i")[0];if($(icon).hasClass("bi-dash")){$("#search-bar ul.sorters li > span.active").parent().find("i").removeClass("bi-chevron-up").removeClass("bi-chevron-down").addClass("bi-dash");$("#search-bar ul.sorters li > span.active").removeClass("active");$(sortElem).find("span").addClass("active");$(icon).removeClass("bi-dash");$(icon).addClass("bi-chevron-up");}else if($(icon).hasClass("bi-chevron-up")){$(icon).removeClass("bi-chevron-up");$(icon).addClass("bi-chevron-down");}else{$(icon).removeClass("bi-chevron-down");$(icon).addClass("bi-dash");$(sortElem).find("span").removeClass("active");}}
applyFilter(data){$.ajax({url:'/api/filter/add',type:'post',headers:{'X-CSRFToken':this.csrf_token},data:{"data":data},dataType:'json',success:function(data){if(data.success)
location.reload()}});}
deleteFilter(key){$.ajax({url:'/api/filter/delete',type:'post',headers:{'X-CSRFToken':this.csrf_token},data:{"key":key},dataType:'json',success:function(data){if(data.success){$("#currentFilters > button[data-code='"+key+"']").remove()
let currentFilters=$("#currentFilters > button")
for(let i=0;i<)}}});}};